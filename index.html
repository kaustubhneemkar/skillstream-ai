<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SkillStream AI Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white font-sans p-8">
    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
            <h1 class="text-3xl font-black text-emerald-400">SKILLSTREAM AI</h1>
            <div class="px-4 py-2 bg-slate-800 rounded-full border border-slate-600">
                <span id="state-badge" class="font-bold text-emerald-400 text-xs uppercase tracking-widest">ACTIVE</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
                <div class="aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl border-4 border-slate-800">
                    <iframe id="video-frame" class="w-full h-full"
                        src="https://www.youtube-nocookie.com/embed/z6hX_2_59kI?enablejsapi=1&autoplay=1&mute=1"
                        frameborder="0" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>

            <div id="nudge-box" class="hidden p-6 bg-yellow-500/10 border-2 border-yellow-500/50 rounded-2xl h-fit">
                <h3 class="text-yellow-500 font-bold mb-2 uppercase text-xs">ðŸ’¡ AI Smart Recap</h3>
                <p id="ai-content" class="text-sm text-yellow-100 italic leading-relaxed">Analyzing...</p>
                <button onclick="resumeVideo()" class="mt-4 w-full py-3 bg-yellow-500 text-black font-bold rounded-xl text-xs uppercase hover:bg-yellow-400 shadow-lg transition-all">Resume Learning</button>
            </div>
        </div>
    </div>

    <script>
        const videoFrame = document.getElementById('video-frame');
        const badge = document.getElementById('state-badge');
        const nudgeBox = document.getElementById('nudge-box');
        let boredTimer = null, isIntervening = false;

        function pauseVideo() {
            videoFrame.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
        }
        function playVideo() {
            videoFrame.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
        }
        function resumeVideo() {
            playVideo();
            nudgeBox.classList.add('hidden');
            isIntervening = false;
        }

        const ws = new WebSocket("ws://127.0.0.1:8000/ws");
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            badge.innerText = data.status.toUpperCase();

            if (data.status === "active") {
                if (boredTimer) { clearTimeout(boredTimer); boredTimer = null; }
                badge.className = "font-bold text-emerald-400 text-xs uppercase tracking-widest";
                if (!isIntervening) { nudgeBox.classList.add('hidden'); }
            } 
            else if (data.status === "bored" && !isIntervening) {
                badge.className = "font-bold text-yellow-500 text-xs uppercase tracking-widest";
                if (!boredTimer) {
                    boredTimer = setTimeout(() => {
                        pauseVideo();
                        nudgeBox.classList.remove('hidden');
                        document.getElementById('ai-content').innerText = data.summary || "Recapping key concepts...";
                        isIntervening = true;
                        boredTimer = null;
                    }, 30000); 
                }
            }
        };
    </script>
</body>
</html>